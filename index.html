<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhishGuard | Cybersecurity Training Simulation</title>
    <!-- Importing a tech/mono font for the hacker/security vibe -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-safe: #10b981; /* Green */
            --accent-danger: #ef4444; /* Red */
            --accent-terminal: #0ea5e9; /* Blue */
            --border-color: #334155;
            --font-mono: 'JetBrains Mono', monospace;
            --font-sans: 'Inter', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-family: var(--font-sans);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header / Dashboard --- */
        header {
            background-color: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 80px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-terminal);
        }

        .stats-bar {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            font-family: var(--font-mono);
        }

        /* Progress Bar */
        .xp-container {
            width: 200px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .xp-bar-bg {
            width: 100%;
            height: 8px;
            background-color: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-terminal), #3b82f6);
            width: 0%;
            transition: width 0.5s ease-out;
        }

        /* --- Main Layout --- */
        main {
            flex: 1;
            display: grid;
            grid-template-columns: 350px 1fr;
            height: calc(100vh - 80px);
        }

        /* Sidebar / Tools */
        aside {
            background-color: #162032;
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .panel-header {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        /* Tool Buttons */
        .tool-btn {
            background-color: var(--bg-dark);
            border: 1px solid var(--accent-terminal);
            color: var(--accent-terminal);
            padding: 0.75rem;
            border-radius: 4px;
            font-family: var(--font-mono);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: bold;
        }

        .tool-btn:hover {
            background-color: var(--accent-terminal);
            color: var(--bg-dark);
        }

        .tool-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: var(--text-secondary);
            color: var(--text-secondary);
            background-color: var(--bg-dark);
        }

        /* Terminal Area */
        #terminal-output {
            background-color: #000;
            border: 1px solid #333;
            border-radius: 4px;
            height: 200px;
            padding: 10px;
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: #33ff00;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        /* Simulation Area */
        #simulation-area {
            padding: 2rem;
            background-color: #0f172a;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Threat Simulation (Email Page) */
        .threat-container {
            background-color: white;
            color: #333;
            width: 100%;
            max-width: 700px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .email-header {
            background-color: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sender-info strong {
            display: block;
            font-size: 1rem;
        }

        .sender-info span {
            font-size: 0.85rem;
            color: #64748b;
        }

        .email-body {
            padding: 2rem;
            line-height: 1.6;
        }

        .email-body h2 {
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .email-body p {
            margin-bottom: 1rem;
        }

        .fake-link {
            color: #3b82f6;
            text-decoration: underline;
            cursor: pointer;
        }

        .phishing-url-preview {
            display: block;
            margin-top: 1rem;
            padding: 0.5rem;
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: #64748b;
        }

        /* Action Buttons */
        .action-panel {
            margin-top: 2rem;
            display: flex;
            gap: 2rem;
            width: 100%;
            max-width: 700px;
            justify-content: center;
        }

        .decision-btn {
            flex: 1;
            padding: 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            cursor: pointer;
            transition: transform 0.1s, filter 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .decision-btn:active {
            transform: scale(0.98);
        }

        .btn-safe {
            background-color: var(--accent-safe);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }
        .btn-safe:hover { filter: brightness(1.1); }

        .btn-phishing {
            background-color: var(--accent-danger);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.2);
        }
        .btn-phishing:hover { filter: brightness(1.1); }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 2.5rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .modal-body {
            margin-bottom: 2rem;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .text-input {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--bg-dark);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 6px;
            font-size: 1rem;
        }

        .primary-btn {
            background-color: var(--accent-terminal);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .primary-btn:hover {
            background-color: #0284c7;
        }

        /* Feedback Modal Specifics */
        .grade-badge {
            font-size: 4rem;
            font-weight: 900;
            margin: 1rem 0;
            font-family: var(--font-mono);
        }
        .grade-A { color: var(--accent-safe); }
        .grade-F { color: var(--accent-danger); }

        .explanation-box {
            background-color: var(--bg-dark);
            padding: 1rem;
            border-radius: 6px;
            text-align: left;
            margin-top: 1rem;
            border-left: 4px solid var(--text-secondary);
        }
        .explanation-box.safe { border-left-color: var(--accent-safe); }
        .explanation-box.phishing { border-left-color: var(--accent-danger); }

        /* Certificate */
        .certificate {
            border: 8px double var(--accent-terminal);
            padding: 2rem;
            background: #fff;
            color: #000;
            text-align: center;
            position: relative;
        }
        .cert-header { font-size: 2.5rem; font-family: serif; font-weight: bold; margin-bottom: 1rem; text-transform: uppercase; }
        .cert-body { font-size: 1.2rem; margin: 2rem 0; line-height: 1.8; }
        .cert-name { font-size: 2rem; font-family: cursive; border-bottom: 2px solid #000; display: inline-block; padding: 0 2rem; margin: 1rem 0; }
        .cert-footer { display: flex; justify-content: space-between; margin-top: 3rem; font-size: 0.9rem; }
        .seal { font-size: 4rem; color: var(--accent-terminal); opacity: 0.8; position: absolute; bottom: 20px; right: 20px; }

        /* Utility */
        .hidden { display: none !important; }

        /* Responsive */
        @media (max-width: 768px) {
            main { grid-template-columns: 1fr; }
            aside { display: none; } /* Hide tools on mobile or make collapsible (simplified here) */
            .stats-bar { gap: 1rem; }
            .xp-container { width: 100px; }
            .action-panel { flex-direction: column; gap: 1rem; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="brand">
            <i class="fas fa-shield-alt"></i>
            PhishGuard
        </div>
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">Current Level</span>
                <span class="stat-value" id="level-display">1</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Streak</span>
                <span class="stat-value" id="streak-display">0</span>
            </div>
            <div class="xp-container">
                <div class="stat-label">XP Progress</div>
                <div class="xp-bar-bg">
                    <div class="xp-bar-fill" id="xp-fill"></div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- Sidebar Tools -->
        <aside>
            <div class="panel">
                <div class="panel-header"><i class="fas fa-satellite-dish"></i> Mission Status</div>
                <div id="mission-desc" style="font-size: 0.9rem; color: #ccc;">Initializing...</div>
            </div>

            <div class="panel" style="flex: 1;">
                <div class="panel-header"><i class="fas fa-code"></i> Deep Scan Tool</div>
                <button class="tool-btn" id="scan-btn" onclick="runDeepScan()">
                    <i class="fas fa-microchip"></i> Run Analysis
                </button>
                <div id="terminal-output"></div>
            </div>
        </aside>

        <!-- Simulation Area -->
        <section id="simulation-area">
            <!-- Threat content injected here via JS -->
            <div id="threat-placeholder" class="threat-container hidden">
                <!-- Content generated dynamically -->
            </div>

            <!-- Decision Buttons -->
            <div class="action-panel hidden" id="action-buttons">
                <button class="decision-btn btn-safe" onclick="makeDecision('safe')">
                    <i class="fas fa-check-circle"></i>
                    LEGITIMATE
                </button>
                <button class="decision-btn btn-phishing" onclick="makeDecision('phishing')">
                    <i class="fas fa-exclamation-triangle"></i>
                    PHISHING
                </button>
            </div>
        </section>
    </main>

    <!-- Modal: Onboarding -->
    <div id="modal-onboarding" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-title">Agent Onboarding</div>
            <div class="modal-body">
                Welcome to PhishGuard. Your mission is to identify malicious emails before they breach the network.
            </div>
            <div class="input-group">
                <label for="agent-name">Enter Agent Codename:</label>
                <input type="text" id="agent-name" class="text-input" placeholder="e.g. CipherOne" autocomplete="off">
            </div>
            <button class="primary-btn" onclick="startGame()">Initialize Simulation</button>
        </div>
    </div>

    <!-- Modal: Feedback -->
    <div id="modal-feedback" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-title" id="feedback-title">Report Card</div>
            <div id="feedback-grade" class="grade-badge">A+</div>
            <div class="modal-body" id="feedback-message">Correct identification.</div>
            <div id="feedback-details" class="explanation-box">
                <!-- Details go here -->
            </div>
            <button class="primary-btn" onclick="nextLevel()">Next Mission</button>
        </div>
    </div>

    <!-- Modal: Certificate -->
    <div id="modal-certificate" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 800px;">
            <div class="certificate">
                <div class="cert-header">Certificate of Completion</div>
                <p>This certifies that</p>
                <div class="cert-name" id="cert-agent-name">Agent Name</div>
                <div class="cert-body">
                    Has successfully completed the 10-Level Phishing Defense Curriculum and is recognized as a<br>
                    <strong>PHISHGUARD ELITE ANALYST</strong>
                </div>
                <div class="cert-footer">
                    <div>Date: <span id="cert-date"></span></div>
                    <div>ID: <span id="cert-id"></span></div>
                </div>
                <div class="seal"><i class="fas fa-shield-alt"></i></div>
            </div>
            <br>
            <button class="primary-btn" onclick="location.reload()">Reset Simulation</button>
        </div>
    </div>

    <script>
        /* --- Game Data --- */
        const levels = [
            {
                id: 1,
                title: "The Basics - Generic Urgency",
                isPhishing: true,
                subject: "Urgent: Account Verification Required",
                sender: "Security Team <security@netflix-support-alert.com>",
                body: `<p>Dear User,</p><p>We detected suspicious activity on your account. Your access will be suspended within 24 hours unless you verify your identity immediately.</p><p>Click the link below to secure your account.</p><a href="#" class="fake-link">Verify Account Now</a>`,
                realUrl: "netflix-support-alert.com",
                analysis: [
                    "Checking Sender Domain... netflix-support-alert.com",
                    "Result: Suspicious TLD combination",
                    "Language Analysis: 'Urgent', 'Suspended', '24 hours'",
                    "Verdict: High probability of Social Engineering"
                ],
                explanation: "This is a classic phishing attempt. The sender domain is not official (netflix.com), and it uses urgent language to force you into acting without thinking."
            },
            {
                id: 2,
                title: "Typosquatting",
                isPhishing: true,
                subject: "Welcome to your PayPal Statement",
                sender: "Service <service@paypa1.com>",
                body: `<p>Your monthly statement is ready. Log in to view your recent transactions and download your invoice.</p><p>Thank you for using PayPal.</p><a href="#" class="fake-link">Login to PayPal</a>`,
                realUrl: "paypa1.com",
                analysis: [
                    "Checking Sender Domain... paypa1.com",
                    "Result: CHARACTER SUBSTITUTION DETECTED",
                    "Original: paypal.com | This: paypa1.com (l vs 1)",
                    "Verdict: Typosquatting Attack"
                ],
                explanation: "Look closely at the domain. The letter 'l' in PayPal has been replaced with the number '1'. This is known as Typosquatting."
            },
            {
                id: 3,
                title: "IT Communication (Legitimate)",
                isPhishing: false,
                subject: "Scheduled Server Maintenance",
                sender: "IT Help Desk <helpdesk@internal-corp.com>",
                body: `<p>Hi Team,</p><p>This is a reminder that we will be performing scheduled maintenance on the internal servers this Saturday from 2 AM to 4 AM EST. You may experience intermittent connectivity issues.</p><p>No action is required on your part.</p><p>Regards,<br>IT Operations</p>`,
                realUrl: "internal-corp.com",
                analysis: [
                    "Checking Sender Domain... internal-corp.com",
                    "Result: Matches Internal Corporate Records",
                    "Content Analysis: Informational, no action requested",
                    "Verdict: Safe / Legitimate"
                ],
                explanation: "This email is safe. It comes from a known internal domain, provides specific, reasonable information, and does not ask for credentials or clicks."
            },
            {
                id: 4,
                title: "The CEO Scam (Business Email Compromise)",
                isPhishing: true,
                subject: "Wire Transfer Request - ASAP",
                sender: "CEO John Doe <ceo.johndoe@gmail.com>",
                body: `<p>I am currently in a meeting and cannot talk. I need you to process a wire transfer of $5,000 to this vendor immediately. I need it done in the next 15 minutes.</p><p>Send me the confirmation once done.</p>`,
                realUrl: "gmail.com",
                analysis: [
                    "Checking Sender Domain... gmail.com",
                    "Result: Personal Email Domain used for Business",
                    "Content Analysis: Financial request, Urgency, 'Can't talk'",
                    "Verdict: Business Email Compromise (BEC)"
                ],
                explanation: "A CEO would never use a personal Gmail account for a wire transfer, nor would they pressure you with '15 minutes'. This is a BEC attack."
            },
            {
                id: 5,
                title: "Document Sharing",
                isPhishing: true,
                subject: "John shared a document with you",
                sender: "Google Docs <docs-noreply@g00gle-drive-share.com>",
                body: `<p>John has invited you to view the document 'Q4 Financials'.</p><a href="#" class="fake-link">Open Document</a>`,
                realUrl: "g00gle-drive-share.com",
                analysis: [
                    "Checking Sender Domain... g00gle-drive-share.com",
                    "Result: Domain Misspelling (g00gle)",
                    "Context Analysis: Unsolicited document sharing",
                    "Verdict: Phishing Vector"
                ],
                explanation: "The domain uses zeros instead of 'o's. Always verify the URL before logging into any document viewer."
            },
            {
                id: 6,
                title: "Shipping Notification (Legitimate)",
                isPhishing: false,
                subject: "Your Amazon Package has been delivered",
                sender: "Amazon Shipping <ship-confirm@amazon.com>",
                body: `<p>Your package has been left at the front porch.</p><p>Track your package to see details.</p><a href="#" class="fake-link">Track Package</a>`,
                realUrl: "amazon.com",
                analysis: [
                    "Checking Sender Domain... amazon.com",
                    "Result: Official Amazon Domain",
                    "Link Analysis: Verified internal routing",
                    "Verdict: Legitimate"
                ],
                explanation: "The email comes from the legitimate 'amazon.com' domain and matches standard shipping notification formats."
            },
            {
                id: 7,
                title: "Spear Phishing - HR Data",
                isPhishing: true,
                subject: "Update your Tax Information",
                sender: "HR Department <hr-update@company-update-portal.net>",
                body: `<p>Annual tax season is here. Please update your W4 information by clicking the link below to avoid tax penalties.</p><a href="#" class="fake-link">Update Tax Info</a>`,
                realUrl: "company-update-portal.net",
                analysis: [
                    "Checking Sender Domain... company-update-portal.net",
                    "Result: Domain not registered to company",
                    "Context: Sensitive data request via unverified link",
                    "Verdict: Spear Phishing"
                ],
                explanation: "Attackers often pretend to be HR. The domain looks close but uses '.net' and 'portal' keywords that aren't part of the official company infrastructure."
            },
            {
                id: 8,
                title: "Prize Scam",
                isPhishing: true,
                subject: "YOU WON A $500 GIFT CARD!",
                sender: "Rewards Center <noreply@rewards-zone.xyz>",
                body: `<p>Congratulations! You have been randomly selected as a winner of a $500 Gift Card.</p><p>Click here to claim your prize before the offer expires in 1 hour.</p><a href="#" class="fake-link">CLAIM NOW</a>`,
                realUrl: "rewards-zone.xyz",
                analysis: [
                    "Checking Sender Domain... rewards-zone.xyz",
                    "Result: Unreliable TLD (.xyz)",
                    "Logic Check: Random reward without participation?",
                    "Verdict: Scam / Phishing"
                ],
                explanation: "If it sounds too good to be true, it is. Also, '.xyz' is a common TLD for scammers due to cheap registration costs."
            },
            {
                id: 9,
                title: "Suspicious Login Attempt (Legitimate)",
                isPhishing: false,
                subject: "Security Alert: New sign-in detected",
                sender: "Dropbox <no-reply@dropbox.com>",
                body: `<p>We noticed a new sign-in to your Dropbox account from a Windows device in New York, USA.</p><p>If this was you, you can ignore this email.</p><p>If this wasn't you, please change your password immediately.</p>`,
                realUrl: "dropbox.com",
                analysis: [
                    "Checking Sender Domain... dropbox.com",
                    "Result: Verified Official Domain",
                    "Intent: Security Notification (Defensive)",
                    "Verdict: Safe / Legitimate"
                ],
                explanation: "Security alerts are common. This comes from the official domain and provides defensive advice rather than demanding a click on a link to 'fix' it."
            },
            {
                id: 10,
                title: "Final Exam - The Grandmaster",
                isPhishing: true,
                subject: "Microsoft 365 Password Expiry",
                sender: "Microsoft Admin <admin-alert@micrasoft-online-security.com>",
                body: `<p>Your password expires today. To prevent service disruption, you must sync your credentials.</p><a href="#" class="fake-link">Sync Credentials</a>`,
                realUrl: "micrasoft-online-security.com",
                analysis: [
                    "Checking Sender Domain... micrasoft-online-security.com",
                    "Result: TYPO + Generic Security Keywords",
                    "Brand Spoofing: 'micrasoft' vs 'microsoft'",
                    "Verdict: Sophisticated Phishing"
                ],
                explanation: "Excellent catch. The attacker used a typo ('micrasoft') and added generic security words ('online-security') to look official at a glance."
            }
        ];

        /* --- Game State --- */
        let currentState = {
            agentName: "",
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            streak: 0,
            scanUsed: false
        };

        /* --- Initialization --- */
        function startGame() {
            const nameInput = document.getElementById('agent-name');
            if (!nameInput.value.trim()) {
                nameInput.style.borderColor = 'red';
                return;
            }
            
            currentState.agentName = nameInput.value.trim();
            document.getElementById('modal-onboarding').classList.add('hidden');
            
            updateUI();
            loadLevel(currentState.level);
        }

        /* --- Level Loading --- */
        function loadLevel(levelIndex) {
            if (levelIndex > levels.length) {
                showCertificate();
                return;
            }

            const levelData = levels[levelIndex - 1];
            currentState.scanUsed = false;

            // Update Mission Description
            document.getElementById('mission-desc').innerHTML = 
                `<strong>Level ${levelIndex}:</strong> ${levelData.title}`;

            // Build Threat UI
            const threatContainer = document.getElementById('threat-placeholder');
            threatContainer.innerHTML = `
                <div class="email-header">
                    <div class="sender-info">
                        <strong>${levelData.subject}</strong>
                        <span>From: ${levelData.sender}</span>
                    </div>
                    <i class="fas fa-envelope-open-text" style="color:#94a3b8"></i>
                </div>
                <div class="email-body">
                    ${levelData.body}
                    <div class="phishing-url-preview">Hover/Link Target: ${levelData.realUrl}</div>
                </div>
            `;
            
            // Reset UI State
            threatContainer.classList.remove('hidden');
            document.getElementById('action-buttons').classList.remove('hidden');
            document.getElementById('scan-btn').disabled = false;
            document.getElementById('terminal-output').innerText = "System Ready...\n> Awaiting Input";
        }

        /* --- Terminal Tool --- */
        function runDeepScan() {
            const output = document.getElementById('terminal-output');
            const levelData = levels[currentState.level - 1];
            
            currentState.scanUsed = true;
            document.getElementById('scan-btn').disabled = true;

            let text = "> Initializing Deep Scan...\n";
            let lineIndex = 0;
            const lines = levelData.analysis;

            output.innerText = text;

            const interval = setInterval(() => {
                if (lineIndex < lines.length) {
                    text += `> ${lines[lineIndex]}\n`;
                    output.innerText = text;
                    output.scrollTop = output.scrollHeight; // Auto scroll
                    lineIndex++;
                } else {
                    clearInterval(interval);
                    // Calculate Risk Score
                    const score = levelData.isPhishing ? (85 + Math.floor(Math.random() * 14)) : (5 + Math.floor(Math.random() * 10));
                    const riskColor = levelData.isPhishing ? "RED" : "GREEN";
                    text += `\n> FINAL RISK SCORE: ${score}% [${riskColor}]`;
                    output.innerText = text;
                    output.scrollTop = output.scrollHeight;
                }
            }, 600); // Typing effect speed
        }

        /* --- Decision Logic --- */
        function makeDecision(choice) {
            const levelData = levels[currentState.level - 1];
            const isCorrect = (choice === 'phishing' && levelData.isPhishing) || 
                              (choice === 'safe' && !levelData.isPhishing);

            const modal = document.getElementById('modal-feedback');
            const title = document.getElementById('feedback-title');
            const grade = document.getElementById('feedback-grade');
            const message = document.getElementById('feedback-message');
            const details = document.getElementById('feedback-details');

            modal.classList.remove('hidden');

            if (isCorrect) {
                // Correct Logic
                currentState.streak++;
                const xpGained = 100 + (currentState.streak * 10);
                currentState.xp += xpGained;
                
                title.innerText = "Threat Neutralized";
                grade.innerText = "A+";
                grade.className = "grade-badge grade-A";
                message.innerText = `Excellent work, Agent ${currentState.agentName}. +${xpGained} XP`;
                
                details.className = "explanation-box " + (levelData.isPhishing ? "phishing" : "safe");
                details.innerHTML = `<strong>Analysis:</strong><br>${levelData.explanation}`;
                
                // Check for level up (technically level advance in this game loop)
                if (currentState.xp >= currentState.xpToNextLevel) {
                    currentState.level++;
                    currentState.xp = 0; // Reset XP for next level progress bar (optional, but requested simple progression)
                    // Note: In this specific design, levels are missions. 
                    // But XP bar fills up per mission. Let's make it simpler:
                    // Finishing a mission advances you to the next level immediately.
                }

            } else {
                // Incorrect Logic
                currentState.streak = 0;
                title.innerText = "Breach Detected";
                grade.innerText = "F";
                grade.className = "grade-badge grade-F";
                message.innerText = `Incorrect classification. The network has been compromised.`;
                
                details.className = "explanation-box " + (levelData.isPhishing ? "phishing" : "safe");
                details.innerHTML = `<strong>Correct Analysis:</strong><br>${levelData.explanation}`;
            }

            updateUI();
        }

        function nextLevel() {
            document.getElementById('modal-feedback').classList.add('hidden');
            // If failed, retry same level? Or advance? The prompt implies a curriculum. 
            // Usually training requires passing to advance.
            
            const levelData = levels[currentState.level - 1];
            // If we just got it right, level increased in makeDecision. 
            // If we got it wrong, level stayed same.
            
            loadLevel(currentState.level);
        }

        /* --- UI Updates --- */
        function updateUI() {
            // Update Stats
            document.getElementById('level-display').innerText = currentState.level;
            document.getElementById('streak-display').innerText = currentState.streak;
            
            // Update XP Bar (Visual only, as levels are linear missions here)
            const percentage = Math.min(100, currentState.xp); 
            document.getElementById('xp-fill').style.width = percentage + '%';
        }

        /* --- Certificate --- */
        function showCertificate() {
            document.getElementById('simulation-area').innerHTML = ''; // Clear game
            document.getElementById('action-buttons').classList.add('hidden');
            document.getElementById('modal-certificate').classList.remove('hidden');

            const now = new Date();
            document.getElementById('cert-agent-name').innerText = currentState.agentName;
            document.getElementById('cert-date').innerText = now.toLocaleDateString();
            document.getElementById('cert-id').innerText = "PHISH-ELITE-" + Math.floor(Math.random() * 10000);
        }

    </script>
</body>
</html>
